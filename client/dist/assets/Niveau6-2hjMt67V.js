import{u as de,r as s,s as ue,a as xe,j as r,g as he,l as pe}from"./index-ByTGM-fq.js";const me=220,fe=["Île-de-France","Auvergne-Rhône-Alpes","Nouvelle-Aquitaine","Occitanie","Hauts-de-France","Provence-Alpes-Côte d’Azur","Grand Est","Pays de la Loire","Bretagne","Normandie","Centre-Val de Loire","Bourgogne-Franche-Comté","Corse","Martinique","Guadeloupe","La Réunion"];function ge(e,u="zelia"){try{if(e!=null&&e.avatar_url&&typeof e.avatar_url=="string")return e.avatar_url;if(e!=null&&e.avatar&&typeof e.avatar=="string")return e.avatar;if(e!=null&&e.avatar_json){let a=e.avatar_json;if(typeof a=="string")try{a=JSON.parse(a)}catch{}if(a&&typeof a=="object"){if(a.url&&typeof a.url=="string")try{const l=new URL(a.url);if(l.protocol.startsWith("http"))return l.searchParams.has("seed")||l.searchParams.set("seed",String(u)),l.searchParams.has("size")||l.searchParams.set("size","300"),l.toString()}catch{}const o=new URLSearchParams;return o.set("seed",String(u)),Object.entries(a).forEach(([l,d])=>{d!=null&&d!==""&&o.set(l,String(d))}),o.has("size")||o.set("size","300"),`https://api.dicebear.com/9.x/lorelei/svg?${o.toString()}`}}}catch{}return`https://api.dicebear.com/9.x/lorelei/svg?${new URLSearchParams({seed:String(u),size:"300",radius:"15"}).toString()}`}function H(e,u={}){try{const i=new URL(e);return/api\.dicebear\.com/.test(i.host)&&/\/lorelei\/svg/.test(i.pathname)?(Object.entries(u).forEach(([o,l])=>{l==null||l===""?i.searchParams.delete(o):i.searchParams.set(o,String(l))}),i.searchParams.has("size")||i.searchParams.set("size","300"),i.toString()):e}catch{return e}}function be(e,u){const[i,a]=s.useState(""),[o,l]=s.useState(!1),d=s.useRef(null),m=s.useRef(null);return s.useEffect(()=>{const h=e||"";a(""),l(!1);let g=0;const f=Math.max(15,Math.floor((u||1500)/Math.max(1,h.length)));return d.current=setInterval(()=>{g+=1,a(h.slice(0,g)),g>=h.length&&clearInterval(d.current)},f),m.current=setTimeout(()=>{clearInterval(d.current),a(h),l(!0)},Math.max(u||1500,(h.length+1)*f)),()=>{d.current&&clearInterval(d.current),m.current&&clearTimeout(m.current)}},[e,u]),{text:i,done:o,skip:()=>{d.current&&clearInterval(d.current),m.current&&clearTimeout(m.current),a(e||""),l(!0)}}}function ye(e){return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.formations)?e.formations:Array.isArray(e==null?void 0:e.items)?e.items:[]:[]}function ve(e,u){const i=Array.isArray(e==null?void 0:e.nm)?e.nm.filter(Boolean):typeof(e==null?void 0:e.nm)=="string"?[e.nm]:[],a=Array.isArray(e==null?void 0:e.tf)?e.tf.filter(Boolean):[],o=[e==null?void 0:e.commune,e==null?void 0:e.departement,e==null?void 0:e.region].filter(Boolean);return{id:(e==null?void 0:e.id)??(e==null?void 0:e.gta)??(e==null?void 0:e.gti)??`formation-${u}`,title:i[0]||(e==null?void 0:e.nmc)||(e==null?void 0:e.etab_nom)||"Formation sans titre",provider:(e==null?void 0:e.etab_nom)||"Organisme non renseigné",city:(e==null?void 0:e.commune)||"",department:(e==null?void 0:e.departement)||"",region:(e==null?void 0:e.region)||"",type:(e==null?void 0:e.tc)||"",year:(e==null?void 0:e.annee)||"",fiche:(e==null?void 0:e.fiche)||(e==null?void 0:e.dataviz)||(e==null?void 0:e.etab_url)||null,etabUrl:(e==null?void 0:e.etab_url)||null,tags:a,locationSummary:o.join(" · ")}}function Ne(){const e=de(),[u,i]=s.useState(null),[a,o]=s.useState(""),[l,d]=s.useState(!0),[m,E]=s.useState(""),[h,g]=s.useState("intro"),[f,Q]=s.useState(0),[L,X]=s.useState(!1),[c,K]=s.useState({keyword:"",region:"",department:"",type:""}),[q,I]=s.useState(!1),[y,M]=s.useState(!1),[U,D]=s.useState(""),[v,z]=s.useState([]),[b,F]=s.useState(null),[T,_]=s.useState(!1),[O,B]=s.useState(""),[Y,$]=s.useState(!1),R=s.useMemo(()=>[{text:"Bravo, tu viens de débloquer le niveau Formations !",durationMs:2200},{text:"Je vais te montrer comment trouver rapidement une formation qui colle à ton projet.",durationMs:4200},{text:"On va faire ça ensemble : tu appliques chaque étape et je reste là si tu bloques.",durationMs:4200},{text:"Prêt·e ? On démarre le tutoriel.",durationMs:2e3}],[]),G=R[f]||{text:"",durationMs:2e3},{text:Z,done:V,skip:ee}=be(G.text,G.durationMs),j=h==="intro"&&!V;s.useEffect(()=>{if(!j)return;const t=setInterval(()=>X(n=>!n),200);return()=>clearInterval(t)},[j]),s.useEffect(()=>{let t=!0;return(async()=>{var n;try{const{data:{user:x}={}}=await ue.auth.getUser();if(!x){e("/login");return}const p=await xe.getProfile().catch(()=>null);if(!t)return;const P=((n=p==null?void 0:p.data)==null?void 0:n.profile)||(p==null?void 0:p.data)||{};i(P),o(ge(P,x.id))}catch(x){if(console.error("Niveau6 profile load failed",x),!t)return;E("Impossible de charger ton profil pour le tutoriel formations.")}finally{t&&d(!1)}})(),()=>{t=!1}},[e]);const re=s.useMemo(()=>{if(!a)return a;try{const t=new URL(a);return/api\.dicebear\.com/.test(t.host)&&/\/lorelei\/svg/.test(t.pathname)?j?H(a,{mouth:L?"happy08":"happy01"}):H(a,{mouth:null}):a}catch{return a}},[a,j,L]),N=c.keyword.trim().length>=2,w=!!(c.region||c.department||c.type),k=y,S=!!b,A=s.useMemo(()=>[{id:"keyword",title:"Choisir un mot-clé",description:"Ex: design, commerce, santé…",done:N},{id:"filters",title:"Affiner avec un filtre",description:"Sélectionne une région, un département ou un type d'établissement.",done:w},{id:"search",title:"Lancer la recherche",description:"Clique sur “Rechercher” pour obtenir des résultats.",done:k},{id:"explore",title:"Explorer une formation",description:"Ouvre la fiche d’une formation qui t’inspire.",done:S}],[N,w,k,S]),te=A.filter(t=>t.done).length,J=Math.round(te/A.length*100),W=A.every(t=>t.done),se=s.useMemo(()=>N?w?k?S?"Tu maîtrises la recherche de formations. Tu peux valider ce niveau quand tu es prêt·e.":"Clique sur une formation pour ouvrir la fiche et note ce qui te plaît.":"Parfait ! Lance la recherche pour voir les formations qui correspondent.":"Super. Ajoute un filtre (région, département ou type d'établissement) pour affiner la recherche.":"Commence par saisir un mot-clé. Pense à ce que tu veux apprendre ou au métier visé.",[N,w,k,S]),ae=()=>{if(!V){ee();return}f+1<R.length?Q(t=>t+1):g("guide")},C=(t,n)=>{K(x=>({...x,[t]:n}))},ne=async t=>{t==null||t.preventDefault(),D(""),I(!0),F(null);try{const n={};c.keyword&&(n.q=c.keyword),c.region&&(n.region=c.region),c.department&&(n.department=c.department),c.type&&(n.type=c.type),n.limit=24;const x=await he.getAll(n),P=ye(x==null?void 0:x.data).map((ie,oe)=>ve(ie,oe));z(P),M(!0)}catch(n){console.warn("Formation search failed",n),z([]),M(!0),D("Impossible de récupérer les formations en ligne. Réessaie dans un instant.")}finally{I(!1)}},le=t=>{F(t);const n=(t==null?void 0:t.fiche)||(t==null?void 0:t.etabUrl);n&&window.open(n,"_blank","noopener,noreferrer")},ce=async()=>{if(W){_(!0),B("");try{await pe({minLevel:6,xpReward:me}),$(!0)}catch(t){console.error("Niveau6 levelUp failed",t),B("Impossible de valider le niveau pour le moment. Réessaie dans un instant.")}finally{_(!1)}}};return l?r.jsxs("div",{className:"p-6 text-center",children:[r.jsx("div",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-black border-t-transparent"}),r.jsx("p",{className:"mt-2 text-text-secondary",children:"Chargement du tutoriel formations…"})]}):m?r.jsx("div",{className:"p-6",children:r.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-red-700",children:m})}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[r.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-card",children:r.jsxs("div",{className:"flex flex-col items-center gap-6 md:flex-row md:items-start",children:[r.jsx("img",{src:re,alt:"Avatar",className:"mx-auto h-40 w-40 rounded-2xl border border-gray-100 bg-white object-contain shadow-sm sm:h-48 sm:w-48 md:mx-0 md:h-64 md:w-64"}),r.jsxs("div",{className:"w-full flex-1",children:[r.jsxs("div",{className:"relative w-full rounded-2xl bg-black p-4 text-white md:p-5",children:[r.jsx("div",{className:"min-h-[3.5rem] whitespace-pre-wrap text-base leading-relaxed md:text-lg",children:h==="intro"?Z:se}),r.jsx("div",{className:"absolute -left-2 top-6 h-0 w-0 border-b-8 border-r-8 border-t-8 border-b-transparent border-r-black border-t-transparent"})]}),h==="intro"?r.jsx("div",{className:"mt-4",children:r.jsx("button",{type:"button",onClick:ae,className:"w-full rounded-lg border border-gray-200 bg-[#c1ff72] px-4 py-2 text-black font-medium sm:w-auto",children:f===R.length-1?"Commencer le tutoriel":"Suivant"})}):r.jsxs("div",{className:"mt-5 space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"mb-1 flex items-center justify-between text-sm text-text-secondary",children:[r.jsx("span",{children:"Progression du tutoriel"}),r.jsxs("span",{children:[J,"%"]})]}),r.jsx("div",{className:"h-2 rounded-full bg-gray-200",children:r.jsx("div",{className:"h-2 rounded-full bg-black",style:{width:`${J}%`}})})]}),r.jsx("div",{className:"space-y-2",children:A.map((t,n)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${t.done?"border-emerald-200 bg-emerald-50":"border-gray-100 bg-gray-50"}`,children:[r.jsx("span",{className:`mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold ${t.done?"bg-black text-white":"border border-gray-300 bg-white text-gray-400"}`,children:t.done?"✓":n+1}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:t.title}),r.jsx("p",{className:"text-sm text-gray-500",children:t.description})]})]},t.id))}),O&&r.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:O}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[r.jsx("button",{type:"button",onClick:ce,disabled:!W||T,className:"inline-flex items-center justify-center rounded-lg border border-gray-200 bg-[#c1ff72] px-4 py-2 text-base font-semibold text-black transition disabled:cursor-not-allowed disabled:opacity-60",children:T?"Validation…":"Valider le niveau"}),r.jsx("button",{type:"button",onClick:()=>e("/app/activites"),className:"inline-flex items-center justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-base font-semibold text-gray-900",children:"Quitter"})]})]})]})]})}),r.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-card",children:h!=="intro"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Rechercher une formation"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Complète les champs, puis lance la recherche."})]}),r.jsx("span",{className:"hidden rounded-full bg-[#c1ff72] px-3 py-1 text-xs font-semibold uppercase tracking-wide text-black md:inline-flex",children:"Tutoriel"})]}),r.jsxs("form",{className:"space-y-4",onSubmit:ne,children:[r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Mot-clé"}),r.jsx("input",{type:"text",value:c.keyword,onChange:t=>C("keyword",t.target.value),placeholder:"Ex: design, communication, data…",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black"})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Région"}),r.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black",value:c.region,onChange:t=>C("region",t.target.value),children:[r.jsx("option",{value:"",children:"Aucune préférence"}),fe.map(t=>r.jsx("option",{value:t,children:t},t))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Département"}),r.jsx("input",{type:"text",value:c.department,onChange:t=>C("department",t.target.value),placeholder:"Ex: Paris, Gironde, Nord...",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Type d'établissement"}),r.jsx("input",{type:"text",value:c.type,onChange:t=>C("type",t.target.value),placeholder:"Ex: Publics, Privés sous contrat...",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black"}),r.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Les libellés doivent correspondre aux valeurs officielles du jeu de données."})]}),r.jsx("button",{type:"submit",disabled:q,className:"inline-flex w-full items-center justify-center rounded-lg border border-gray-200 bg-black px-4 py-2 text-base font-semibold text-white transition hover:bg-gray-900 disabled:cursor-not-allowed disabled:opacity-70",children:q?"Recherche en cours…":"Rechercher"})]}),U&&r.jsx("div",{className:"mt-4 rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700",children:U}),r.jsxs("div",{className:"mt-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Résultats"}),y&&r.jsxs("span",{className:"text-sm text-gray-500",children:[v.length," formation(s) trouvée(s)"]})]}),!y&&r.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:"Utilise le formulaire ci-dessus pour lancer ta première recherche."}),y&&v.length===0&&r.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:"Aucun résultat pour ces critères. Essaie un autre mot-clé ou élargis les filtres."}),v.length>0&&r.jsx("div",{className:"grid grid-cols-1 gap-4",children:v.map((t,n)=>r.jsxs("button",{type:"button",onClick:()=>le(t),className:`w-full rounded-2xl border px-4 py-4 text-left transition hover:border-black hover:bg-gray-50 ${(b==null?void 0:b.id)===t.id?"border-black bg-gray-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.title}),r.jsx("p",{className:"text-sm text-gray-600",children:t.provider})]}),t.type&&r.jsx("span",{className:"rounded-full bg-[#f68fff]/20 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-[#6a3a87]",children:t.type})]}),r.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 text-sm text-gray-600 md:grid-cols-3",children:[t.locationSummary&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Lieu :"})," ",t.locationSummary]}),t.type&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Type :"})," ",t.type]}),t.year&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Année :"})," ",t.year]})]}),Array.isArray(t.tags)&&t.tags.length>0&&r.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:t.tags.slice(0,4).map((x,p)=>r.jsxs("span",{className:"rounded-full bg-gray-100 px-2.5 py-1 text-xs text-gray-700",children:["#",x]},p))}),(t.fiche||t.etabUrl)&&r.jsx("p",{className:"mt-3 text-sm text-gray-500 underline",children:"Consulter la fiche officielle"})]},t.id||n))}),b&&r.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Ce que tu peux noter :"}),r.jsxs("ul",{className:"mt-2 list-disc space-y-1 pl-5 text-sm text-gray-600",children:[r.jsx("li",{children:"Les spécialisations proposées par la formation (thématiques officielles)."}),r.jsx("li",{children:"L'établissement d'accueil et son type (public, privé...)."}),r.jsx("li",{children:"La localisation précise (commune, département, région)."}),r.jsx("li",{children:"Le lien Parcoursup pour connaître les modalités d'inscription."})]})]})]})]}):r.jsxs("div",{className:"flex h-full min-h-[420px] flex-col items-center justify-center text-center text-gray-600",children:[r.jsx("span",{className:"mb-4 inline-flex h-12 w-12 items-center justify-center rounded-full bg-[#c1ff72] text-2xl",children:"🎯"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lance le tutoriel pour accéder à la recherche"}),r.jsx("p",{className:"mt-2 max-w-sm text-sm text-gray-500",children:"Clique sur « Commencer le tutoriel » à gauche. Les filtres et les formations officielles apparaîtront juste ici pour t'accompagner étape par étape."})]})})]}),Y&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4",children:r.jsxs("div",{className:"relative w-full max-w-md rounded-3xl border border-gray-200 bg-white p-8 text-center shadow-2xl",children:[r.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 flex h-12 w-12 items-center justify-center rounded-full bg-[#c1ff72] text-2xl shadow-lg",children:"🎓"}),r.jsx("h3",{className:"mt-4 text-2xl font-extrabold text-gray-900",children:"Niveau 6 validé !"}),r.jsx("p",{className:"mt-2 text-gray-500",children:"Tu sais maintenant rechercher et comparer les formations qui t’intéressent. Continue ton parcours pour aller encore plus loin."}),r.jsxs("div",{className:"mt-6 flex flex-col gap-3 sm:flex-row sm:justify-center",children:[r.jsx("button",{type:"button",onClick:()=>e("/app/activites"),className:"inline-flex items-center justify-center rounded-xl bg-[#c1ff72] px-5 py-3 text-base font-semibold text-black transition hover:bg-[#b3ff5d]",children:"Retour aux activités"}),r.jsx("button",{type:"button",onClick:()=>$(!1),className:"inline-flex items-center justify-center rounded-xl border border-gray-200 px-5 py-3 text-base font-semibold text-gray-700 transition hover:bg-gray-100",children:"Rester ici"})]})]})})]})}export{Ne as default};
