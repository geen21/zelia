import{r as y,u as Q,s as E,a as F,b as Z,j as e,A as $,q as B}from"./index-C3BZ17kn.js";class U{constructor(s="zelia"){this.levelThreshold=i=>Math.round(80+28*Math.pow(i-1,1.22)),this.seed=String(s||"zelia")}setSeed(s){this.seed=String(s||"zelia")}processEvent(s,i){let a={...s},c=0,h=[];switch(i.type){case"micro_action":c=Math.random()>.5?3:5;break;case"quiz_completed":c=35,i.questId&&h.push(i.questId);break;case"mission_completed":c=65,h.push(i.questId);break;case"meeting_completed":c=120,h.push(i.questId);break;case"parcoursup_milestone":c=200,h.push(i.questId);break;case"video_watched":c=15;break}a.progression.xp+=c;const l=this.calculateLevel(a.progression.xp),j=l>a.progression.level;a.progression.level=l,a.progression.toNext=this.levelThreshold(l+1)-a.progression.xp;const r=[...Array.isArray(a.quests)?a.quests:[],...h].filter(Boolean);a.quests=Array.from(new Set(r));const o=this.generateResponse(a,i,c,j,h);if(o&&Array.isArray(o.perks)){const u=Array.isArray(a.perks)?a.perks:[];a.perks=Array.from(new Set([...u,...o.perks]))}return{newState:a,response:o}}calculateLevel(s){let i=1;for(;s>=this.levelThreshold(i+1)&&i<50;)i++;return i}generateResponse(s,i,a,c,h){const l=s.progression.level,j=this.getArc(l);let t="calm",r="",o=[],u=[];switch(c&&(t="celebratory",r=`Bravo ! Tu passes au niveau ${l} ! `,u=this.unlockPerks(l)),j){case"exploration":r||(r="Commençons ton aventure d'orientation ! "),r+="Explorons tes premiers intérêts ensemble.",t=t==="calm"?"encouraging":t,o=[{id:"complete_test",type:"quiz_completed",label:"Compléter le test d'orientation",xp:35},{id:"explore_interests",type:"micro_action",label:"Explorer mes centres d'intérêt",xp:5},{id:"watch_intro",type:"video_watched",label:"Regarder la vidéo d'introduction",xp:15}];break;case"interets_forces":r||(r="Maintenant, approfondissons tes forces ! "),r+="Quels sont tes talents cachés ?",t=t==="calm"?"thinking":t,o=[{id:"strengths_quiz",type:"quiz_completed",label:"Quiz sur tes forces",xp:40},{id:"personality_test",type:"mission_completed",label:"Test de personnalité approfondi",xp:60},{id:"values_exploration",type:"micro_action",label:"Définir tes valeurs",xp:8}];break;case"recherche_metiers":r||(r="Place à la découverte des métiers ! "),r+="Quels univers professionnels t'attirent ?",t=t==="calm"?"focused":t,o=[{id:"job_research",type:"mission_completed",label:"Rechercher 5 métiers correspondants",xp:70},{id:"salary_analysis",type:"micro_action",label:"Analyser les salaires",xp:10},{id:"job_videos",type:"video_watched",label:"Vidéos métiers recommandés",xp:20}];break;case"immersions_rencontres":r||(r="Temps de rencontrer des professionnels ! "),r+="Prêt(e) pour des échanges inspirants ?",t=t==="calm"?"excited":t,o=[{id:"schedule_meeting",type:"meeting_completed",label:"Planifier un entretien professionnel",xp:120},{id:"prepare_questions",type:"mission_completed",label:"Préparer tes questions",xp:50},{id:"company_visit",type:"meeting_completed",label:"Visite d'entreprise virtuelle",xp:100}];break;case"competences_soft_skills":r||(r="Développons tes compétences ! "),r+="Montrons ce dont tu es capable.",t=t==="calm"?"proud":t,o=[{id:"soft_skills_assessment",type:"mission_completed",label:"Évaluation des soft skills",xp:80},{id:"star_method",type:"quiz_completed",label:"Méthode STAR pour tes expériences",xp:45},{id:"leadership_test",type:"micro_action",label:"Test de leadership",xp:12}];break;case"cv_lm":r||(r="Créons ton CV et ta lettre ! "),r+="Premier pas vers Parcoursup.",t=t==="calm"?"focused":t,o=[{id:"cv_builder",type:"mission_completed",label:"Générateur de CV guidé",xp:90},{id:"cover_letter",type:"mission_completed",label:"Rédiger ta lettre de motivation",xp:85},{id:"cv_review",type:"micro_action",label:"Révision et amélioration",xp:15}];break;case"parcoursup_preparation":r||(r="Direction Parcoursup ! "),r+="Préparons ton dossier d'excellence.",t=t==="calm"?"thinking":t,o=[{id:"projet_motive",type:"parcoursup_milestone",label:"Rédiger ton projet motivé",xp:200},{id:"voeux_strategy",type:"mission_completed",label:"Stratégie de vœux",xp:120},{id:"calendar_planning",type:"micro_action",label:"Planifier ton calendrier",xp:20}];break;case"orals_pitch":r||(r="Préparons tes oraux ! "),r+="Tu vas briller lors des entretiens.",t=t==="calm"?"encouraging":t,o=[{id:"pitch_practice",type:"mission_completed",label:"Entraînement pitch 60 secondes",xp:100},{id:"interview_simulation",type:"meeting_completed",label:"Simulation d'entretien avec Zélia",xp:150},{id:"confidence_building",type:"quiz_completed",label:"Exercices de confiance",xp:40}];break;case"dossiers_avances":r||(r="Perfectionnons tout ! "),r+="Ton dossier sera exceptionnel.",t=t==="calm"?"proud":t,o=[{id:"portfolio_review",type:"parcoursup_milestone",label:"Révision complète du portfolio",xp:180},{id:"coherence_check",type:"mission_completed",label:"Vérification de cohérence",xp:90},{id:"final_polish",type:"micro_action",label:"Finitions et optimisations",xp:25}];break;case"maitrise_finale":r||(r="Tu es maintenant expert(e) ! "),r+="Accompagne d'autres dans leur parcours.",t=t==="calm"?"celebratory":t,o=[{id:"mentor_others",type:"meeting_completed",label:"Mentorat d'autres utilisateurs",xp:200},{id:"success_story",type:"mission_completed",label:"Partager ton histoire",xp:150},{id:"expert_badge",type:"parcoursup_milestone",label:"Obtenir le badge expert",xp:250}];break}const N=this.generateAvatar(t);return{progression:s.progression,ui:{speak:r},suggestedActions:o,avatar:N,perks:u,xpGained:a}}getArc(s){return s<=5?"exploration":s<=10?"interets_forces":s<=15?"recherche_metiers":s<=20?"immersions_rencontres":s<=25?"competences_soft_skills":s<=30?"cv_lm":s<=35?"parcoursup_preparation":s<=40?"orals_pitch":s<=45?"dossiers_avances":"maitrise_finale"}unlockPerks(s){const i=[];return s===5&&i.push("Checklist intelligente débloquée"),s===10&&i.push("Générateur de CV disponible"),s===15&&i.push("Bibliothèque d'exemples débloquée"),s===20&&i.push("Conseils personnalisés activés"),s===25&&i.push("Simulateur de cohérence disponible"),s===30&&i.push("Alertes calendrier activées"),s===35&&i.push("Coaching express débloqué"),s===40&&i.push("Révisions STAR disponibles"),s===45&&i.push("Mode mentor activé"),s===50&&i.push("Maître Zélia - Badge ultime !"),i}generateAvatar(s){const i=["ffdfbf","ffeaa7","d63031","fd79a8"],a=`${this.seed}-${s||"calm"}`,c=Array.from(a).reduce((o,u)=>o*31+u.charCodeAt(0)>>>0,0),t={...{size:"200",radius:"15",backgroundColor:i[c%i.length],skinColor:"fdbcb4",hairColor:"4a4a4a",eyesColor:"000000",seed:this.seed},...{happy:{mouth:"happy12",glassesProbability:"0",frecklesProbability:"0"},excited:{mouth:"happy17",hairAccessories:"flowers",hairAccessoriesProbability:"60",eyesColor:"000000"},calm:{mouth:"happy04",frecklesProbability:"10"},focused:{mouth:"happy03",glasses:"variant03",glassesProbability:"100"},thinking:{mouth:"sad03",glasses:"variant02",glassesProbability:"60"},proud:{mouth:"happy15",head:"variant02",hairAccessories:"flowers",hairAccessoriesProbability:"40"},confused:{mouth:"sad05",glassesProbability:"0",frecklesProbability:"20"},encouraging:{mouth:"happy10",eyesColor:"000000"},celebratory:{mouth:"happy18",hairAccessories:"flowers",hairAccessoriesProbability:"80"}}[s]};return{dicebear:`https://api.dicebear.com/9.x/lorelei/svg?${Object.entries(t).map(([o,u])=>`${o}=${u}`).join("&")}`,emotion:s}}}function I(g,s,i="zelia"){try{if(g!=null&&g.avatar&&typeof g.avatar=="string")return{dicebear:g.avatar,emotion:(s==null?void 0:s.emotion)||"calm"};if(g!=null&&g.avatar_json){let a=g.avatar_json;if(typeof a=="string")try{a=JSON.parse(a)}catch{}if(a&&typeof a=="object"){const c=new URLSearchParams;return c.set("seed",String(i)),Object.entries(a).forEach(([h,l])=>{l!=null&&l!==""&&c.set(h,String(l))}),c.has("size")||c.set("size","200"),{dicebear:`https://api.dicebear.com/9.x/lorelei/svg?${c.toString()}`,emotion:(s==null?void 0:s.emotion)||"calm"}}}}catch{}return s||{dicebear:"",emotion:"calm"}}const J=()=>{var R,T;const[g,s]=y.useState(null),[i,a]=y.useState(null),[c,h]=y.useState(!1),[l,j]=y.useState(null),[t]=y.useState(new U),[r,o]=y.useState(null),u=Q();y.useEffect(()=>{let n=!0;return(async()=>{var v;const{data:{user:p}}=await E.auth.getUser();if(!p){u("/login");return}if(n){s(p);try{t.setSeed(p.id)}catch{}try{const[x,b]=await Promise.all([F.getProfile().catch(()=>null),Z.get(`/progression/${p.id}`).catch(()=>null)]),f=((v=x==null?void 0:x.data)==null?void 0:v.profile)||null;n&&a(f);const d=(b==null?void 0:b.data)||{},O={progression:{level:(d==null?void 0:d.level)||1,xp:(d==null?void 0:d.xp)||0,toNext:t.levelThreshold(((d==null?void 0:d.level)||1)+1)-((d==null?void 0:d.xp)||0)},quests:(d==null?void 0:d.quests)||[],perks:(d==null?void 0:d.perks)||[]};if(!n)return;let q=!1;try{const{data:P}=await E.from("user_responses").select("id").eq("user_id",p.id).eq("questionnaire_type","inscription").limit(1);q=Array.isArray(P)&&P.length>0}catch{}n&&h(q);const z=O;let _=t.generateResponse(z,{type:"init"},0,!1,[]);f&&(_={..._,avatar:I(f,_.avatar,p.id)}),q&&(_={..._,suggestedActions:(_.suggestedActions||[]).filter(P=>P.id!=="complete_test")}),j(z),o(_)}catch(x){console.error("Init load error:",x);const b={progression:{level:1,xp:0,toNext:t.levelThreshold(2)},quests:[],perks:[]};if(!n)return;j(b);let f=t.generateResponse(b,{type:"init"},0,!1,[]);i&&(f={...f,avatar:I(i,f.avatar,p.id)}),o(f)}}})(),()=>{n=!1}},[u,t]);const N=((R=l==null?void 0:l.progression)==null?void 0:R.level)??1,C=((T=l==null?void 0:l.progression)==null?void 0:T.xp)??0,L=y.useMemo(()=>{const n=t.levelThreshold(N+1),p=N<=1?0:t.levelThreshold(N),v=Math.max(1,n-p),x=Math.max(0,Math.min(n-p,C-p));return Math.max(0,Math.min(100,x/v*100))},[N,C,t]);if(!l||!r)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full border-4 border-gray-200 relative",children:[e.jsx("div",{className:"absolute inset-1 rounded-full border-4",style:{borderColor:"#c1ff72"}}),e.jsx("div",{className:"absolute right-0 bottom-0 h-3 w-3 rounded-full",style:{background:"#f68fff"}})]}),e.jsxs("div",{className:"text-lg font-semibold text-gray-800",children:["Chargement de ton aventure ",e.jsx("span",{className:"text-[#f68fff]",children:"Zélia"}),"…"]}),e.jsx("div",{className:"mt-3 h-2 w-48 bg-gray-200 rounded-full mx-auto overflow-hidden",children:e.jsx("div",{className:"h-2 bg-[#c1ff72]",style:{width:"60%"}})})]})});const{progression:m}=l,S=10,V=(m==null?void 0:m.level)||1,w=Math.min(Math.max(1,V),S),k=w>=1&&w<=S,{ui:D,avatar:G,perks:A,xpGained:M}=r;return e.jsx("div",{className:"min-h-screen bg-white p-4",children:e.jsx("div",{className:"mx-auto w-full",children:e.jsxs("div",{className:"lg:grid lg:grid-cols-3 lg:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-3xl p-8 border border-gray-200 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:G.dicebear,alt:"Avatar Zélia",className:"w-24 h-24 rounded-full border-4 border-white shadow-lg",loading:"lazy",decoding:"async",width:"96",height:"96"}),e.jsxs("div",{className:"absolute -bottom-2 -right-2 bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-bold",children:["Niv. ",m.level]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:["Aventure Zélia - Niveau ",m.level]}),e.jsxs("button",{onClick:()=>{k&&u(`/app/niveau/${w}`)},className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm border transition ${k?"bg-[#f68fff] text-white border-transparent hover:opacity-90":"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}`,title:k?`Aller au Niveau ${w}`:"Tous les niveaux disponibles sont terminés",disabled:!k,children:[e.jsx("span",{role:"img","aria-label":"jeu",children:"🎮"}),e.jsx("span",{children:k?`Aller au Niveau ${w}`:"Niveaux terminés"})]})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:D.speak})]})]}),M>0&&e.jsxs("div",{className:"bg-[#c1ff72] text-black px-4 py-2 rounded-lg font-bold border border-gray-200",children:["+",M," XP !"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[m.xp," XP"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[m.toNext," XP jusqu'au niveau ",m.level+1]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:e.jsx("div",{className:"h-4 rounded-full bg-[#c1ff72]",style:{width:`${L}%`}})})]})]}),e.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-gray-200 shadow-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Revoir mes résultats"}),e.jsx("button",{onClick:()=>u("/app/results"),className:"text-sm text-text-secondary hover:text-text-primary",children:"Voir tout"})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 items-center",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"Consulte ton analyse et tes recommandations personnalisées pour guider tes prochaines actions."}),e.jsx("div",{className:"text-right",children:e.jsxs("button",{onClick:()=>u("/app/results"),className:"inline-flex items-center gap-2 bg-black text-white px-4 py-2 rounded-lg text-sm",children:[e.jsx("i",{className:"ph ph-arrow-up-right"}),"Ouvrir mes résultats"]})})]})]}),A&&A.length>0&&e.jsx("div",{className:"bg-[#fffbf7] border border-gray-200 p-4 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-2xl",children:"🎉"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm text-gray-800",children:e.jsx("strong",{children:"Nouveaux bonus débloqués :"})}),e.jsx("ul",{className:"list-disc list-inside text-gray-700",children:A.map((n,p)=>e.jsx("li",{children:n},p))})]})]})}),e.jsxs("div",{className:"bg-white rounded-3xl p-8 border border-gray-200 shadow-card",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6 text-center",children:"Roadmap vers Parcoursup Excellence"}),e.jsx("div",{className:"grid md:grid-cols-5 gap-4",children:[{levels:"1-5",title:"Exploration",emoji:"🌟",color:"from-green-400 to-green-600"},{levels:"6-10",title:"Intérêts & Forces",emoji:"💪",color:"from-blue-400 to-blue-600"},{levels:"11-15",title:"Recherche Métiers",emoji:"🔍",color:"from-purple-400 to-purple-600"},{levels:"16-20",title:"Immersions",emoji:"🤝",color:"from-orange-400 to-orange-600"},{levels:"21-25",title:"Compétences",emoji:"🎯",color:"from-pink-400 to-pink-600"},{levels:"26-30",title:"CV & LM",emoji:"📄",color:"from-indigo-400 to-indigo-600"},{levels:"31-35",title:"Parcoursup",emoji:"🎓",color:"from-red-400 to-red-600"},{levels:"36-40",title:"Oraux",emoji:"🎤",color:"from-yellow-400 to-yellow-600"},{levels:"41-45",title:"Excellence",emoji:"⭐",color:"from-teal-400 to-teal-600"},{levels:"46-50",title:"Maîtrise",emoji:"👑",color:"from-purple-600 to-pink-600"}].map((n,p)=>{const v=parseInt(n.levels.split("-")[0]),x=parseInt(n.levels.split("-")[1]),b=m.level>=v&&m.level<=x,f=m.level>x;return e.jsxs("div",{className:`relative p-4 rounded-xl text-center ${b?"bg-white border-2 border-[#c1ff72] text-gray-800":f?"bg-gray-100 border-2 border-green-400":"bg-white border border-gray-200"}`,children:[e.jsx("div",{className:"text-2xl mb-2",children:n.emoji}),e.jsxs("div",{className:"text-xs font-bold mb-1",children:["Niveaux ",n.levels]}),e.jsx("div",{className:"text-sm font-medium",children:n.title}),f&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs",children:"✓"}),b&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-[#c1ff72] text-black rounded-full w-6 h-6 flex items-center justify-center text-xs border border-gray-200",children:"⚡"})]},p)})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center border border-gray-200 shadow-card",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m.level}),e.jsx("div",{className:"text-sm text-gray-600",children:"Niveau Actuel"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center border border-gray-200 shadow-card",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.xp}),e.jsx("div",{className:"text-sm text-gray-600",children:"XP Total"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center border border-gray-200 shadow-card",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(m.level/50*100),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Progression"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 text-center border border-gray-200 shadow-card",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:50-m.level}),e.jsx("div",{className:"text-sm text-gray-600",children:"Niveaux Restants"})]})]})]}),e.jsx("aside",{className:"mt-6 lg:mt-0 lg:col-span-1 lg:sticky lg:top-6",children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 border border-gray-200 shadow-card",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"Toutes les quêtes"}),(()=>{const n=new Set(l.quests||[]),p=$.length,v=n.size;return e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:[v," / ",p," complétée(s)"]}),e.jsx("ul",{className:"space-y-2 max-h-[420px] overflow-auto pr-1",children:$.map(x=>{const b=n.has(x);return e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-800",children:B(x)}),b?e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[#c1ff72] text-black border border-gray-200",children:"OK"}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 border border-gray-200",children:"À faire"})]},x)})})]})})()]})})]})})})};console.log("Activites component loaded");export{J as default};
