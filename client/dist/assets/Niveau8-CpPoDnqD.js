import{u as D,r as s,s as C,a as _,j as e,l as B}from"./index-CSn0w5x6.js";function F(r,m="zelia"){try{if(r!=null&&r.avatar_url&&typeof r.avatar_url=="string")return r.avatar_url;if(r!=null&&r.avatar&&typeof r.avatar=="string")return r.avatar;if(r!=null&&r.avatar_json){let i=r.avatar_json;if(typeof i=="string")try{i=JSON.parse(i)}catch{}if(i&&typeof i=="object"){if(i.url&&typeof i.url=="string")try{const c=new URL(i.url);return c.searchParams.has("seed")||c.searchParams.set("seed",String(m)),c.searchParams.has("size")||c.searchParams.set("size","300"),c.toString()}catch{}const u=new URLSearchParams;return u.set("seed",String(m)),Object.entries(i).forEach(([c,l])=>{l!=null&&l!==""&&u.set(c,String(l))}),u.has("size")||u.set("size","300"),`https://api.dicebear.com/9.x/lorelei/svg?${u.toString()}`}}}catch{}return`https://api.dicebear.com/9.x/lorelei/svg?${new URLSearchParams({seed:String(m),size:"300",radius:"15"}).toString()}`}function q(r,m){const[v,i]=s.useState(""),[u,c]=s.useState(!1),l=s.useRef(null),h=s.useRef(null);return s.useEffect(()=>{i(""),c(!1);const d=r||"";let x=0;const o=Math.max(15,Math.floor((m||1500)/Math.max(1,d.length)));return l.current=setInterval(()=>{x++,i(d.slice(0,x)),x>=d.length&&clearInterval(l.current)},o),h.current=setTimeout(()=>{clearInterval(l.current),i(d),c(!0)},Math.max(m||1500,(d.length+1)*o)),()=>{l.current&&clearInterval(l.current),h.current&&clearTimeout(h.current)}},[r,m]),{text:v,done:u,skip:()=>{l.current&&clearInterval(l.current),h.current&&clearTimeout(h.current),i(r||""),c(!0)}}}function J(){const r=D(),[m,v]=s.useState(null),[i,u]=s.useState(""),[c,l]=s.useState(!0),[h,S]=s.useState(""),[d,x]=s.useState(0),[o,T]=s.useState("intro"),w=s.useRef(null),N=s.useRef(!1),[P,k]=s.useState(!1),[O,E]=s.useState("");s.useEffect(()=>{let t=!0;return(async()=>{var n;try{const{data:{user:a}}=await C.auth.getUser();if(!a){r("/login");return}E(a.id);const f=await _.getProfile().catch(()=>null);if(!t)return;const g=((n=f==null?void 0:f.data)==null?void 0:n.profile)||null;v(g),u(F(g,a.id))}catch(a){if(console.error(a),!t)return;S("Erreur de chargement")}finally{t&&l(!1)}})(),()=>{t=!1}},[r]);const b=s.useMemo(()=>[{text:"Welcome back ! Alors, tu as trouv√© des ami.es que √ßa peut int√©resser ? ;) L‚Äôorientation, √ßa doit √™tre accessible √† tout le monde. C‚Äôest si dur d‚Äôy voir clair, mais je suis s√ªre que ce parcours peut aider beaucoup d‚Äô√©l√®ves comme toi",durationMs:6e3},{text:"Bref, je sais pas pourquoi je parle trop comme √ßa. Moi aussi j‚Äôai encore des choses sur lesquelles je dois bosser ahah.",durationMs:3500},{text:"Comme une vid√©o vaut mille mots, je te laisse d√©couvrir une vid√©o faite par Nicolas, l‚Äôun des dirigeants de la soci√©t√© Z√©lia. Il parle de la r√©alit√© de l‚Äôorientation‚Ä¶ Rien que √ßa !",durationMs:6500}],[]),R=b[d]||{text:"",durationMs:1500},{text:M,done:p,skip:A}=q(R.text,R.durationMs);s.useEffect(()=>{if(o!=="intro"||p)return;const t=setInterval(()=>k(n=>!n),200);return()=>clearInterval(t)},[o,p]);function y(t,n={}){try{const a=new URL(t);return/api\.dicebear\.com/.test(a.host)&&/\/lorelei\/svg/.test(a.pathname)?(Object.entries(n).forEach(([g,j])=>{j==null||j===""?a.searchParams.delete(g):a.searchParams.set(g,String(j))}),a.searchParams.has("size")||a.searchParams.set("size","300"),a.toString()):t}catch{return t}}const U=s.useMemo(()=>{let t=i;return!t||!(()=>{try{const a=new URL(t);return/api\.dicebear\.com/.test(a.host)&&/\/lorelei\/svg/.test(a.pathname)}catch{return!1}})()||(o==="intro"&&d===b.length-1?t=y(t,{eyes:"variant16"}):t=y(t,{}),o==="intro"&&!p?t=y(t,{mouth:P?"happy08":null}):t=y(t,{mouth:null})),t},[i,o,d,p,P,b.length]);s.useEffect(()=>{if(o!=="watch")return;function t(){if(!(w.current||N.current))try{const n=window.YT;if(!n||!n.Player)return;w.current=new n.Player("niv8Player",{height:"315",width:"560",videoId:"VmT_MBRb-oE",playerVars:{rel:0,modestbranding:1,playsinline:1},events:{onReady:()=>{N.current=!0},onStateChange:a=>{a.data===window.YT.PlayerState.ENDED&&I()}}})}catch(n){console.warn("YT init failed",n)}}if(!window.YT||!window.YT.Player){if(!document.getElementById("youtube-iframe-api")){const f=document.createElement("script");f.src="https://www.youtube.com/iframe_api",f.id="youtube-iframe-api",document.body.appendChild(f)}const a=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){if(typeof a=="function")try{a()}catch{}t()}}else t();return()=>{try{const n=w.current;n&&n.destroy&&n.destroy()}catch{}w.current=null,N.current=!1}},[o]);function Y(){if(!p){A();return}d+1<b.length?x(t=>t+1):T("watch")}const[z,L]=s.useState(!1);function I(){L(!0),(async()=>{try{await B({minLevel:8,xpReward:180})}catch(t){console.warn("Progression update failed (non-blocking):",t)}})()}return c?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-black border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-2 text-text-secondary",children:"Chargement‚Ä¶"})]}):h?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg",children:h})}):e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-card",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[e.jsx("img",{src:U,alt:"Avatar",className:"w-40 h-40 sm:w-48 sm:h-48 md:w-64 md:h-64 rounded-2xl border border-gray-100 shadow-sm object-contain bg-white mx-auto md:mx-0"}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsxs("div",{className:"relative bg-black text-white rounded-2xl p-4 md:p-5 w-full",children:[e.jsx("div",{className:"text-base md:text-lg leading-relaxed whitespace-pre-wrap min-h-[3.5rem]",children:o==="intro"?e.jsx(e.Fragment,{children:M}):o==="watch"?e.jsx(e.Fragment,{children:"Regarde la vid√©o √† droite, puis on continue."}):null}),e.jsx("div",{className:"absolute -left-2 top-6 w-0 h-0 border-t-8 border-b-8 border-r-8 border-t-transparent border-b-transparent border-r-black"})]}),o==="intro"&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:Y,className:"px-4 py-2 rounded-lg bg-[#c1ff72] text-black border border-gray-200 w-full sm:w-auto",children:d===b.length-1?"Oui laisse moi voir la vid√©o":"Suivant"})})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-black rounded-full flex items-center justify-center text-white",children:"üé¨"}),e.jsx("h2",{className:"text-xl font-bold",children:"Vid√©o"})]}),o!=="watch"?e.jsx("div",{className:"text-text-secondary",children:"La vid√©o appara√Ætra ici."}):e.jsxs("div",{children:[e.jsx("div",{className:"relative w-full",style:{paddingTop:"56.25%"},children:e.jsx("div",{id:"niv8Player",className:"absolute inset-0"})}),e.jsx("noscript",{children:e.jsx("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/VmT_MBRb-oE?si=b7PcF02YzscpiFio",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:I,className:"px-4 py-2 rounded-lg bg-white text-gray-900 border border-gray-300 w-full sm:w-auto",children:"J'ai termin√© la vid√©o"})})]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"relative bg-white border border-gray-200 rounded-2xl p-8 shadow-2xl text-center max-w-md w-11/12",children:[e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 w-10 h-10 bg-[#c1ff72] rounded-full flex items-center justify-center shadow-md animate-bounce",children:"üèÜ"}),e.jsx("h3",{className:"text-2xl font-extrabold mb-2",children:"Niveau 8 r√©ussi !"}),e.jsx("p",{className:"text-text-secondary mb-4",children:"Bravo, tu as regard√© la vid√©o sur la r√©alit√© de l‚Äôorientation."}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:e.jsx("button",{onClick:()=>r("/app/activites"),className:"px-4 py-2 rounded-lg bg-[#c1ff72] text-black border border-gray-200",children:"Retour aux activit√©s"})}),e.jsxs("div",{className:"pointer-events-none absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute w-2 h-2 bg-pink-400 rounded-full left-6 top-8 animate-ping"}),e.jsx("div",{className:"absolute w-2 h-2 bg-yellow-400 rounded-full right-8 top-10 animate-ping"}),e.jsx("div",{className:"absolute w-2 h-2 bg-blue-400 rounded-full left-10 bottom-8 animate-ping"}),e.jsx("div",{className:"absolute w-2 h-2 bg-green-400 rounded-full right-6 bottom-10 animate-ping"})]})]})})]})}export{J as default};
