import{u as ie,r as a,s as de,a as ue,j as r,b as xe,l as fe}from"./index-C3BZ17kn.js";const he=220,pe=["CDI","CDD","Alternance","Stage","Intérim","Saisonnier"];function me(e,s="zelia"){try{if(e!=null&&e.avatar_url&&typeof e.avatar_url=="string")return e.avatar_url;if(e!=null&&e.avatar&&typeof e.avatar=="string")return e.avatar;if(e!=null&&e.avatar_json){let o=e.avatar_json;if(typeof o=="string")try{o=JSON.parse(o)}catch{}if(o&&typeof o=="object"){if(o.url&&typeof o.url=="string")try{const n=new URL(o.url);if(n.protocol.startsWith("http"))return n.searchParams.has("seed")||n.searchParams.set("seed",String(s)),n.searchParams.has("size")||n.searchParams.set("size","300"),n.toString()}catch{}const u=new URLSearchParams;return u.set("seed",String(s)),Object.entries(o).forEach(([n,i])=>{i!=null&&i!==""&&u.set(n,String(i))}),u.has("size")||u.set("size","300"),`https://api.dicebear.com/9.x/lorelei/svg?${u.toString()}`}}}catch{}return`https://api.dicebear.com/9.x/lorelei/svg?${new URLSearchParams({seed:String(s),size:"300",radius:"15"}).toString()}`}function G(e,s={}){try{const c=new URL(e);return/api\.dicebear\.com/.test(c.host)&&/\/lorelei\/svg/.test(c.pathname)?(Object.entries(s).forEach(([u,n])=>{n==null||n===""?c.searchParams.delete(u):c.searchParams.set(u,String(n))}),c.searchParams.has("size")||c.searchParams.set("size","300"),c.toString()):e}catch{return e}}function ge(e,s){const[c,o]=a.useState(""),[u,n]=a.useState(!1),i=a.useRef(null),x=a.useRef(null);return a.useEffect(()=>{const f=e||"";o(""),n(!1);let g=0;const m=Math.max(15,Math.floor((s||1500)/Math.max(1,f.length)));return i.current=setInterval(()=>{g+=1,o(f.slice(0,g)),g>=f.length&&clearInterval(i.current)},m),x.current=setTimeout(()=>{clearInterval(i.current),o(f),n(!0)},Math.max(s||1500,(f.length+1)*m)),()=>{i.current&&clearInterval(i.current),x.current&&clearTimeout(x.current)}},[e,s]),{text:c,done:u,skip:()=>{i.current&&clearInterval(i.current),x.current&&clearTimeout(x.current),o(e||""),n(!0)}}}function be(e){return e?Array.isArray(e)?e:Array.isArray(e==null?void 0:e.items)?e.items:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e==null?void 0:e.results)?e.results:[]:[]}function h(e){if(e==null)return"";const s=String(e).trim();if(!s)return"";const c=s.toLowerCase();return c==="nan"||c==="null"||c==="undefined"?"":s}function ye(e,s){const c=h(e==null?void 0:e.intitule),o=h((e==null?void 0:e.entreprise_nom)||(e==null?void 0:e.entreprise)),u=h((e==null?void 0:e.typecontrat)||(e==null?void 0:e.type_contrat)),n=h((e==null?void 0:e.lieutravail_libelle)||(e==null?void 0:e.lieu_travail_libelle)||(e==null?void 0:e.lieu)),i=h((e==null?void 0:e.romecode)||(e==null?void 0:e.rome_code)),x=h((e==null?void 0:e.dateactualisation)||(e==null?void 0:e.date_actualisation)),v=h((e==null?void 0:e.origineoffre_urlorigine)||(e==null?void 0:e.origine_offre_url_origine)),f=h((e==null?void 0:e.contact_urlpostulation)||(e==null?void 0:e.contact_url_postulation)),g=h(e==null?void 0:e.entreprise_logo),m=h((e==null?void 0:e.lieutravail_latitude)||(e==null?void 0:e.lieu_travail_latitude)),j=h((e==null?void 0:e.lieutravail_longitude)||(e==null?void 0:e.lieu_travail_longitude)),d=m?Number.parseFloat(m):null,N=j?Number.parseFloat(j):null;return{id:(e==null?void 0:e.id)||`emploi-${s}`,title:c||"Intitulé non renseigné",company:o||"Entreprise non indiquée",contract:u,location:n,rome:i,updatedAt:x,applyUrl:v,contactUrl:f,logo:g,coordinates:Number.isFinite(d)&&Number.isFinite(N)?{latitude:d,longitude:N}:null}}function ve(e){if(!e)return"";try{const s=new Date(e);return Number.isNaN(s.getTime())?"":new Intl.DateTimeFormat("fr-FR",{day:"numeric",month:"long",year:"numeric"}).format(s)}catch{return""}}function Ne(){const e=ie(),[s,c]=a.useState(""),[o,u]=a.useState(!0),[n,i]=a.useState(""),[x,v]=a.useState("intro"),[f,g]=a.useState(0),[m,j]=a.useState(!1),[d,N]=a.useState({keyword:"",contract:"",location:""}),[U,D]=a.useState(!1),[w,T]=a.useState(!1),[L,z]=a.useState(""),[k,F]=a.useState([]),[y,q]=a.useState(null),[O,$]=a.useState(!1),[J,V]=a.useState(""),[H,B]=a.useState(!1),P=a.useMemo(()=>[{text:"Te voilà au niveau Métiers ! On va apprendre à trouver des offres de jobs en un clin d’œil.",durationMs:3200},{text:"Je vais te guider pour utiliser la page Emplois et repérer les opportunités qui collent à ton profil.",durationMs:3800},{text:"Prépare un mot-clé, un contrat et suis-moi étape par étape. Prêt·e ?",durationMs:2800}],[]),W=P[f]||{text:"",durationMs:2e3},{text:K,done:Q,skip:Z}=ge(W.text,W.durationMs),S=x==="intro"&&!Q;a.useEffect(()=>{if(!S)return;const t=setInterval(()=>j(l=>!l),200);return()=>clearInterval(t)},[S]),a.useEffect(()=>{let t=!0;return(async()=>{var l;try{const{data:{user:p}={}}=await de.auth.getUser();if(!p){e("/login");return}const b=await ue.getProfile().catch(()=>null);if(!t)return;const M=((l=b==null?void 0:b.data)==null?void 0:l.profile)||(b==null?void 0:b.data)||{};c(me(M,p.id))}catch(p){if(console.error("Niveau9 profile load failed",p),!t)return;i("Impossible de charger ton profil pour le tutoriel métiers.")}finally{t&&u(!1)}})(),()=>{t=!1}},[e]);const ee=a.useMemo(()=>{if(!s)return s;try{const t=new URL(s);return/api\.dicebear\.com/.test(t.host)&&/\/lorelei\/svg/.test(t.pathname)?S?G(s,{mouth:m?"happy08":"happy01"}):G(s,{mouth:null}):s}catch{return s}},[s,S,m]),C=d.keyword.trim().length>=2,_=!!(d.contract||d.location),A=w,R=!!y,E=a.useMemo(()=>[{id:"keyword",title:"Choisir un mot-clé",description:"Ex: développeur, vente, marketing…",done:C},{id:"filters",title:"Sélectionner un filtre",description:"Contrat ou lieu pour cibler les offres.",done:_},{id:"search",title:"Lancer la recherche",description:"Clique sur “Rechercher” pour afficher les offres.",done:A},{id:"explore",title:"Explorer une offre",description:"Ouvre la fiche ou note les infos clés.",done:R}],[C,_,A,R]),re=E.filter(t=>t.done).length,X=Math.round(re/E.length*100),Y=E.every(t=>t.done),te=a.useMemo(()=>C?_?A?R?"Tu maîtrises maintenant la recherche de jobs. Tu peux valider ce niveau quand tu veux.":"Clique sur une offre et observe le contrat, la localisation et la date.":"Parfait, lance la recherche pour voir les offres disponibles.":"Top ! Ajoute un type de contrat ou précise un lieu pour affiner.":"Commence par saisir un mot-clé. Pense au métier ou au secteur que tu vises.",[C,_,A,R]),se=()=>{if(!Q){Z();return}f+1<P.length?g(t=>t+1):v("guide")},I=(t,l)=>{N(p=>({...p,[t]:l}))},ae=async t=>{t==null||t.preventDefault(),z(""),D(!0),q(null);try{const l={page:1,page_size:24};d.keyword.trim()&&(l.q=d.keyword.trim()),d.contract&&(l.typecontrat=d.contract),d.location.trim()&&(l.location=d.location.trim());const p=await xe.get("/catalog/metiers/search",{params:l}),M=be(p==null?void 0:p.data).map((oe,ce)=>ye(oe,ce));F(M),T(!0)}catch(l){console.warn("Job search failed",l),F([]),T(!0),z("Impossible de récupérer les offres. Réessaie dans un instant.")}finally{D(!1)}},ne=t=>{q(t);const l=(t==null?void 0:t.applyUrl)||(t==null?void 0:t.contactUrl);l&&window.open(l,"_blank","noopener,noreferrer")},le=async()=>{if(Y){$(!0),V("");try{await fe({minLevel:9,xpReward:he}),B(!0)}catch(t){console.error("Niveau9 levelUp failed",t),V("Impossible de valider le niveau pour le moment. Réessaie dans un instant.")}finally{$(!1)}}};return o?r.jsxs("div",{className:"p-6 text-center",children:[r.jsx("div",{className:"inline-block h-6 w-6 animate-spin rounded-full border-2 border-black border-t-transparent"}),r.jsx("p",{className:"mt-2 text-text-secondary",children:"Chargement du tutoriel métiers…"})]}):n?r.jsx("div",{className:"p-6",children:r.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-red-700",children:n})}):r.jsxs("div",{className:"p-4 md:p-6",children:[r.jsxs("div",{className:"grid grid-cols-1 items-start gap-6 lg:grid-cols-2",children:[r.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-card",children:r.jsxs("div",{className:"flex flex-col items-center gap-6 md:flex-row md:items-start",children:[r.jsx("img",{src:ee,alt:"Avatar",className:"mx-auto h-40 w-40 rounded-2xl border border-gray-100 bg-white object-contain shadow-sm sm:h-48 sm:w-48 md:mx-0 md:h-64 md:w-64"}),r.jsxs("div",{className:"w-full flex-1",children:[r.jsxs("div",{className:"relative w-full rounded-2xl bg-black p-4 text-white md:p-5",children:[r.jsx("div",{className:"min-h-[3.5rem] whitespace-pre-wrap text-base leading-relaxed md:text-lg",children:x==="intro"?K:te}),r.jsx("div",{className:"absolute -left-2 top-6 h-0 w-0 border-b-8 border-r-8 border-t-8 border-b-transparent border-r-black border-t-transparent"})]}),x==="intro"?r.jsx("div",{className:"mt-4",children:r.jsx("button",{type:"button",onClick:se,className:"w-full rounded-lg border border-gray-200 bg-[#c1ff72] px-4 py-2 text-black font-medium sm:w-auto",children:f===P.length-1?"Commencer le tutoriel":"Suivant"})}):r.jsxs("div",{className:"mt-5 space-y-4",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"mb-1 flex items-center justify-between text-sm text-text-secondary",children:[r.jsx("span",{children:"Progression du tutoriel"}),r.jsxs("span",{children:[X,"%"]})]}),r.jsx("div",{className:"h-2 rounded-full bg-gray-200",children:r.jsx("div",{className:"h-2 rounded-full bg-black",style:{width:`${X}%`}})})]}),r.jsx("div",{className:"space-y-2",children:E.map((t,l)=>r.jsxs("div",{className:`flex items-start gap-3 rounded-xl border px-3 py-3 ${t.done?"border-emerald-200 bg-emerald-50":"border-gray-100 bg-gray-50"}`,children:[r.jsx("span",{className:`mt-1 inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-semibold ${t.done?"bg-black text-white":"border border-gray-300 bg-white text-gray-400"}`,children:t.done?"✓":l+1}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900",children:t.title}),r.jsx("p",{className:"text-sm text-gray-500",children:t.description})]})]},t.id))}),J&&r.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:J}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[r.jsx("button",{type:"button",onClick:le,disabled:!Y||O,className:"inline-flex items-center justify-center rounded-lg border border-gray-200 bg-[#c1ff72] px-4 py-2 text-base font-semibold text-black transition disabled:cursor-not-allowed disabled:opacity-60",children:O?"Validation…":"Valider le niveau"}),r.jsx("button",{type:"button",onClick:()=>e("/app/activites"),className:"inline-flex items-center justify-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-base font-semibold text-gray-900",children:"Quitter"})]})]})]})]})}),r.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-card",children:x!=="intro"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Rechercher un emploi"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Complète les filtres, puis lance la recherche."})]}),r.jsx("span",{className:"hidden rounded-full bg-[#c1ff72] px-3 py-1 text-xs font-semibold uppercase tracking-wide text-black md:inline-flex",children:"Tutoriel"})]}),r.jsxs("form",{className:"space-y-4",onSubmit:ae,children:[r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Mot-clé"}),r.jsx("input",{type:"text",value:d.keyword,onChange:t=>I("keyword",t.target.value),placeholder:"Ex: développeur, vendeur, marketing…",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black"})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Type de contrat"}),r.jsxs("select",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black",value:d.contract,onChange:t=>I("contract",t.target.value),children:[r.jsx("option",{value:"",children:"Tous"}),pe.map(t=>r.jsx("option",{value:t,children:t},t))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Lieu"}),r.jsx("input",{type:"text",className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black",value:d.location,onChange:t=>I("location",t.target.value),placeholder:"Ville, département…"})]})]}),r.jsx("button",{type:"submit",disabled:U,className:"inline-flex w-full items-center justify-center rounded-lg border border-gray-200 bg-black px-4 py-2 text-base font-semibold text-white transition hover:bg-gray-900 disabled:cursor-not-allowed disabled:opacity-70",children:U?"Recherche en cours…":"Rechercher"})]}),L&&r.jsx("div",{className:"mt-4 rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-700",children:L}),r.jsxs("div",{className:"mt-6 space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Résultats"}),w&&r.jsxs("span",{className:"text-sm text-gray-500",children:[k.length," offre(s) trouvée(s)"]})]}),!w&&r.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:"Utilise le formulaire ci-dessus pour lancer ta première recherche."}),w&&k.length===0&&r.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-600",children:"Aucun résultat pour ces critères. Essaie un autre mot-clé ou élargis les filtres."}),k.length>0&&r.jsx("div",{className:"grid grid-cols-1 gap-4",children:k.map((t,l)=>r.jsxs("button",{type:"button",onClick:()=>ne(t),className:`w-full rounded-2xl border px-4 py-4 text-left transition hover:border-black hover:bg-gray-50 ${(y==null?void 0:y.id)===t.id?"border-black bg-gray-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:t.title}),r.jsx("p",{className:"text-sm text-gray-600",children:t.company})]}),t.contract&&r.jsx("span",{className:"rounded-full bg-[#f68fff]/20 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-[#6a3a87]",children:t.contract})]}),r.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-2 text-sm text-gray-600 md:grid-cols-3",children:[t.location&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Lieu :"})," ",t.location]}),t.rome&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Code ROME :"})," ",t.rome]}),t.updatedAt&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-gray-800",children:"Mise à jour :"})," ",ve(t.updatedAt)||t.updatedAt]})]}),t.applyUrl&&r.jsx("p",{className:"mt-3 text-sm text-gray-500 underline",children:"Voir l’offre officielle"})]},t.id||l))}),y&&r.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50 p-4",children:[r.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Ce que tu peux noter :"}),r.jsxs("ul",{className:"mt-2 list-disc space-y-1 pl-5 text-sm text-gray-600",children:[r.jsx("li",{children:"Le type de contrat et la localisation précise."}),r.jsx("li",{children:"La localisation exacte et la date de mise à jour."}),r.jsx("li",{children:"Le code ROME pour approfondir le métier."}),r.jsx("li",{children:"Les liens pour postuler ou contacter l’entreprise."})]})]})]})]}):r.jsxs("div",{className:"flex h-full min-h-[420px] flex-col items-center justify-center text-center text-gray-600",children:[r.jsx("span",{className:"mb-4 inline-flex h-12 w-12 items-center justify-center rounded-full bg-[#c1ff72] text-2xl",children:"💼"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Lance le tutoriel pour accéder à la recherche"}),r.jsx("p",{className:"mt-2 max-w-sm text-sm text-gray-500",children:"Clique sur « Commencer le tutoriel » à gauche. Les filtres et les offres apparaîtront juste ici pour t'accompagner étape par étape."})]})})]}),H&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4",children:r.jsxs("div",{className:"relative w-full max-w-md rounded-3xl border border-gray-200 bg-white p-8 text-center shadow-2xl",children:[r.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 flex h-12 w-12 items-center justify-center rounded-full bg-[#c1ff72] text-2xl shadow-lg",children:"🏆"}),r.jsx("h3",{className:"mt-4 text-2xl font-extrabold text-gray-900",children:"Niveau 9 validé !"}),r.jsx("p",{className:"mt-2 text-gray-500",children:"Tu sais maintenant filtrer et analyser les offres d’emploi. Continue ton parcours pour concrétiser ton projet."}),r.jsxs("div",{className:"mt-6 flex flex-col gap-3 sm:flex-row sm:justify-center",children:[r.jsx("button",{type:"button",onClick:()=>e("/app/activites"),className:"inline-flex items-center justify-center rounded-xl bg-[#c1ff72] px-5 py-3 text-base font-semibold text-black transition hover:bg-[#b3ff5d]",children:"Retour aux activités"}),r.jsx("button",{type:"button",onClick:()=>B(!1),className:"inline-flex items-center justify-center rounded-xl border border-gray-200 px-5 py-3 text-base font-semibold text-gray-700 transition hover:bg-gray-100",children:"Rester ici"})]})]})})]})}export{Ne as default};
